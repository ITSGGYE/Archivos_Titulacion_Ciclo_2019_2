<script>module.exports={data:function data(){return{form:{_nombres:"",_apellidos:"",_id_ctlg_tipos_documentos:"",_numero_documento:"",_id_ctlg_genero:"",_correo:"",_direccion:"",_telefono:"",_celular:"",_id_ctlg_paises:"",_id_ctlg_provincias:"",_id_ctlg_parroquias:"",_id_ctlg_cantones:"",_fecha_nacimiento:"",_id_ctlg_tipos_sangre:"",_id_ctlg_parentescos:"",_observacion:"",_contrasena:""},options:{tipos_documentos:[],generos:[],paises:[],provincias:[],parroquias:[],cantones:[],tipos_sangre:[],parentescos:[]}}},created:function created(){var a=this;_.merge(this.form,_.get(this,"formOld",{})),Promise.all([this.tipos_documentos(),this.generos(),this.paises(),this.provincias(),this.perfiles(),this.tipos_sangre(),this.parentescos()]).then(function(){a.init()})},methods:{perfiles:function perfiles(){var a=this;return _.rget("usuarios/perfiles").then(function(b){a.options.perfiles=b.data})},paises:function paises(){var a=this;return _.rget("catalogos/paises").then(function(b){a.options.paises=b.data})},tipos_documentos:function tipos_documentos(){var a=this;return _.rget("catalogos/tipos_documentos").then(function(b){a.options.tipos_documentos=b.data})},generos:function generos(){var a=this;return _.rget("catalogos/generos").then(function(b){a.options.generos=b.data})},provincias:function provincias(){var a=this;return _.rget("catalogos/provincias").then(function(b){a.options.provincias=b.data})},parroquias:function parroquias(){var a=this;return _.rget("catalogos/provincias_parroquias/".concat(this.form._id_ctlg_cantones)).then(function(b){a.options.parroquias=b.data})},cantones:function cantones(){var a=this;return _.rget("catalogos/provincias_cantones/".concat(this.form._id_ctlg_provincias)).then(function(b){a.options.cantones=b.data})},tipos_sangre:function tipos_sangre(){var a=this;return _.rget("catalogos/tipos_sangre").then(function(b){a.options.tipos_sangre=b.data})},parentescos:function parentescos(){var a=this;return _.rget("catalogos/parentescos").then(function(b){a.options.parentescos=b.data})},validEmail:function validEmail(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},crear_email:function crear_email(){for(no=this.form._nombres.split(" ",3),ap=this.form._apellidos.split(" ",3),ere="",i=0;i<no.length;i++)ere+=no[i].charAt(0);return mu="".concat(ere).concat(ap[0],"@").concat(this.CONFIG.APP_NAME,".com").toLocaleLowerCase(),this.form._correo=mu,this.form._correo},guardar:function guardar(){var a=this;if(this.form._contrasena="$2a$10$lEriprPBGkW/BBEksEaWuOdXY4moVgngZ7S.OFbCr3T1hm7UuzwGO",null===this.form._nombres||""===this.form._nombres||null===this.form._apellidos||""===this.form._apellidos||null===this.form._celular||""===this.form._celular||null===this.form._id_ctlg_genero||""===this.form._id_ctlg_genero||null===this.form._correo||""===this.form._correo||null===this.form._id_ctlg_parentescos||""===this.form._id_ctlg_parentescos||null===this.form._id_ctlg_tipos_documentos||""===this.form._id_ctlg_tipos_documentos||null===this.form._numero_documento||""===this.form._numero_documento||null===this.form._direccion||""===this.form._direccion||null===this.form._id_ctlg_paises||""===this.form._id_ctlg_paises||null===this.form._id_ctlg_provincias||""===this.form._id_ctlg_provincias||null===this.form._id_ctlg_parroquias||""===this.form._id_ctlg_parroquias||null===this.form._id_ctlg_cantones||""===this.form._id_ctlg_cantones||null===this.form._fecha_nacimiento||""===this.form._fecha_nacimiento||null===this.form._id_ctlg_tipos_sangre||""===this.form._id_ctlg_tipos_sangre)this.$q.notify({type:"negative",message:"LLene los campos vacios"});else if(!this.validEmail(this.form._correo))this.$q.notify({type:"negative",message:"correo invalido"});else if(1==this.form._id_ctlg_tipos_documentos){var b=this.form._numero_documento;if(10==b.length){var c=b.substring(0,2);if(1<=c&&24>=c){var d=b.substring(9,10),e=parseInt(b.substring(1,2))+parseInt(b.substring(3,4))+parseInt(b.substring(5,6))+parseInt(b.substring(7,8)),f=b.substring(0,1),f=2*f;if(9<f)var f=f-9;var g=b.substring(2,3),g=2*g;if(9<g)var g=g-9;var h=b.substring(4,5),h=2*h;if(9<h)var h=h-9;var j=b.substring(6,7),j=2*j;if(9<j)var j=j-9;var k=b.substring(8,9),k=2*k;if(9<k)var k=k-9;var l=f+g+h+j+k,m=e+l,n=(m+"").substring(0,1),o=10*(parseInt(n)+1),p=o-m;if(10==p)var p=0;p==d?(this.$q.loading.show(),_.rpost("estudiantes",null,this.form).then(function(){a.close(),a.$parent.listaEstudiantes(),a.$q.notify({type:"positive",message:"Guardada con exito"})})["catch"](function(b){a.$q.notify({type:"negative",message:b.message||"Hubo un error al guardar"})})["finally"](function(){a.$q.loading.hide()})):this.$q.notify({type:"negative",message:"la cedula es incorrecta"})}else this.$q.notify({type:"negative",message:"Esta cedula no pertenece a ninguna region"})}else this.$q.notify({type:"negative",message:"Esta cedula tiene menos de 10 Digitos"})}else this.$q.loading.show(),_.rpost("estudiantes",null,this.form).then(function(){a.close(),a.$parent.listaEstudiantes(),a.$q.notify({type:"positive",message:"Guardada con exito"})})["catch"](function(b){a.$q.notify({type:"negative",message:b.message||"Hubo un error al guardar"})})["finally"](function(){a.$q.loading.hide()})}}};</script> <style></style> <template> <q-dialog v-model="state" persistent transition-show="scale" transition-hide="scale" > <q-card style="width: 300px"> <q-card-section> <div class="text-h6">Estudiante</div> </q-card-section> <q-card-section style="max-height: 50vh" class="scroll"> <q-form class="q-gutter-md"> <q-input v-model.trim="form._nombres" label="Nombres" @input="crear_email()" :rules="[(val) => !!val || '* Requerido']" ></q-input> <q-input v-model.trim="form._apellidos" label="Apellidos" @input="crear_email()" lazy-rules :rules="[ (val) => (val && val.length > 0) || '*Requerido', ]" ></q-input> <q-select v-model="form._id_ctlg_tipos_documentos" :options="options.tipos_documentos" label="Tipo de documento" emit-value map-options :rules="[(val) => !!val || '* Requerido']" ></q-select> <q-input v-model.trim="form._numero_documento" label="Número de documento" type="number" :rules="[ (val) => (val && val.length > 0) || '*Requerido', ]" ></q-input> <q-select v-model="form._id_ctlg_genero" :options="options.generos" label="Genero" emit-value map-options :rules="[(val) => !!val || '* Requerido']" ></q-select> <q-input v-model="form._correo" label="Correo" type="email" lazy-rules :rules="[ (val) => (val && val.length > 0) || '*Requerido', ]" ></q-input> <!--<q-input v-model="form._pruebas" label="prueba"></q-input>--> <q-input v-model.trim="form._direccion" label="Dirección" lazy-rules :rules="[ (val) => (val && val.length > 0) || '*Requerido', ]" ></q-input> <q-input v-model="form._telefono" label="Telefono de Emergencia" type="tel" mask=" ### - ####" ></q-input> <q-input v-model="form._celular" label="Celular de Emergencia" type="tel" mask=" ##-########" lazy-rules :rules="[ (val) => (val && val.length > 0) || '*Requerido', ]" ></q-input> <q-select v-model="form._id_ctlg_paises" :options="options.paises" label="País de Nacimiento" emit-value map-options lazy-rules :rules="[(val) => !!val || '* Requerido']" ></q-select> <q-input v-model="form._fecha_nacimiento" label="Fecha de Nacimiento" type="date" stack-label lazy-rules :rules="[(val) => !!val || '* Requerido']" ></q-input> <q-select v-model="form._id_ctlg_provincias" @input="cantones()" :options="options.provincias" label="Provincia de Residencia" emit-value map-options :rules="[(val) => !!val || '* Requerido']" ></q-select> <q-select v-model="form._id_ctlg_cantones" @input="parroquias()" :options="options.cantones" label="Cantón de Residencia" emit-value map-options lazy-rules :rules="[(val) => !!val || '* Requerido']" ></q-select> <q-select v-model="form._id_ctlg_parroquias" :options="options.parroquias" label="Parroquia de Residencia" emit-value map-options :rules="[(val) => !!val || '* Requerido']" ></q-select> <q-select v-model="form._id_ctlg_tipos_sangre" :options="options.tipos_sangre" label="Tipo de Sangre" emit-value map-options :rules="[(val) => !!val || '* Requerido']" ></q-select> <q-select v-model="form._id_ctlg_parentescos" :options="options.parentescos" label="Con quién vive" emit-value map-options :rules="[(val) => !!val || '* Requerido']" ></q-select> <!--<q-select v-model="form._id_perfiles" :options="options.perfiles" label="Perfil" emit-value map-options ></q-select>--> <q-input v-model="form._observacion" label="Observación" type="textarea" ></q-input> </q-form> </q-card-section> <q-card-actions align="right"> <q-btn color="primary" @click="guardar">Guardar</q-btn> <q-btn flat v-close-popup>cancelar</q-btn> </q-card-actions> </q-card> </q-dialog></template>