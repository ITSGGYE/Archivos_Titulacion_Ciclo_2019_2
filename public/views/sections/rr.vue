<script>module.exports={data:function data(){return{filter:"",step:1,formActualizar:!1,ids:-1,id_estudiantesss:" ",nombress:"",apellidoss:"",id_ctlg_tipos_documentoss:"",numero_documentoss:"",correoss:"",direccionss:"",telefonoss:"",celularss:"",id_ctlg_profesioness:"",id_ctlg_estados_civilss:"",id_ctlg_cantoness:"",id_ctlg_parentescoss:"",lugar_trabajoss:"",direccion_trabajoss:"",telefono_trabajoss:"",cargoss:"",options:{tipos_documentos:[],profesiones:[],estados_civil:[],estudiantes:[],cantones:[],parentescos:[]},familiares:{loading:!1,columns:[{name:"numero_documento",field:"numero_documento",label:"N\xFAmero Documento"},{name:"nombre_completo",field:"nombre_completo",label:"Representante"},{name:"nombre",field:"nombre",label:"Estudiante"},{name:"parentesco",field:"parentesco",label:"Parentesco"},{name:"telefono",field:"telefono",label:"Tel\xE9fono"},{name:"celular",field:"celular",label:"Celular"},{name:"lugar_trabajo",field:"lugar_trabajo",label:"Lugar de Trabajo"},{name:"telefono_trabajo",field:"telefono_trabajo",label:"Tel\xE9fono de Trabajo"}],data:[]}}},filters:{capitalize:function capitalize(a){return a?(a=a.toString(),a.charAt(0).toUpperCase()+a.slice(1)):""},upper:function upper(a){return a?(a=a.toString(),a.toUpperCase()):""}},created:function created(){var a=this;this.listaFamiliares(),Promise.all([this.tipos_documentos(),this.profesiones(),this.estados_civil(),this.estudiantes(),this.cantones(),this.parentescos()]).then(function(){a.init()})},methods:{excel:function excel(){this.report("Reporte Representante-Estudiante",this.familiares.columns,this.familiares.data)},profesiones:function profesiones(){var a=this;return _.rget("catalogos/profesiones").then(function(b){a.options.profesiones=b.data})},tipos_documentos:function tipos_documentos(){var a=this;return _.rget("catalogos/tipos_documentos").then(function(b){a.options.tipos_documentos=b.data})},estados_civil:function estados_civil(){var a=this;return _.rget("catalogos/estados_civil").then(function(b){a.options.estados_civil=b.data})},estudiantes:function estudiantes(){var a=this;return _.rget("estudiantes/ctlg").then(function(b){a.options.estudiantes=b.data})},cantones:function cantones(){var a=this;return _.rget("catalogos/cantones").then(function(b){a.options.cantones=b.data})},parentescos:function parentescos(){var a=this;return _.rget("catalogos/parentescos").then(function(b){a.options.parentescos=b.data})},validEmail:function validEmail(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},editarFamiliar:function editarFamiliar(a){this.ids=a.id,this.nombress=a.nombres,this.apellidoss=a.apellidos,this.id_ctlg_tipos_documentoss=a.id_ctlg_tipos_documentos,this.numero_documentoss=a.numero_documento,this.correoss=a.correo,this.direccionss=a.direccion_domicilio,this.telefonoss=a.telefono,this.celularss=a.celular,this.id_ctlg_profesioness=a.id_ctlg_profesiones,this.id_ctlg_estados_civilss=a.id_ctlg_estados_civil,this.id_ctlg_cantoness=a.id_ctlg_cantones,this.id_ctlg_parentescoss=a.id_ctlg_parentescos,this.lugar_trabajoss=a.lugar_trabajo,this.direccion_trabajoss=a.direccion_trabajo,this.telefono_trabajoss=a.telefono_trabajo,this.cargoss=a.cargo,this.id_estudiantesss=a.nombre,this.formActualizar=!0},guardar:function guardar(a){var b=this;if(!this.validEmail(this.correoss))this.$q.notify({type:"negative",message:"correo invalido"});else if(null===this.nombress||""===this.nombress||null===this.apellidoss||""===this.apellidoss||null===this.telefonos||""===this.telefonoss||null===this.celularss||""===this.celularss||null===this.id_ctlg_profesioness||""===this.id_ctlg_profesioness||null===this.id_ctlg_estados_civilss||""===this.id_ctlg_estados_civilss||null===this.id_ctlg_parentescoss||""===this.id_ctlg_parentescoss||null===this.numero_documentoss||""===this.numero_documentoss)this.$q.notify({type:"negative",message:"No se puede actualizar"});else if(1==this.id_ctlg_tipos_documentoss){var c=this.numero_documentoss;if(10==c.length){var d=c.substring(0,2);if(1<=d&&24>=d){var e=c.substring(9,10),f=parseInt(c.substring(1,2))+parseInt(c.substring(3,4))+parseInt(c.substring(5,6))+parseInt(c.substring(7,8)),g=c.substring(0,1),g=2*g;if(9<g)var g=g-9;var h=c.substring(2,3),h=2*h;if(9<h)var h=h-9;var i=c.substring(4,5),i=2*i;if(9<i)var i=i-9;var j=c.substring(6,7),j=2*j;if(9<j)var j=j-9;var k=c.substring(8,9),k=2*k;if(9<k)var k=k-9;var l=g+h+i+j+k,m=f+l,n=(m+"").substring(0,1),o=10*(parseInt(n)+1),p=o-m;if(10==p)var p=0;p==e?(this.$q.loading.show(),_.rput("familiares/".concat(this.ids),null,{ids:a.id,nombress:this.nombress,apellidoss:this.apellidoss,numero_documentoss:this.numero_documentoss,correoss:this.correoss,direccionss:this.direccionss,telefonoss:this.telefonoss,celularss:this.celularss,id_ctlg_profesioness:this.id_ctlg_profesioness,id_ctlg_estados_civilss:this.id_ctlg_estados_civilss,id_ctlg_cantoness:this.id_ctlg_cantoness,id_ctlg_parentescoss:this.id_ctlg_parentescoss,lugar_trabajoss:this.lugar_trabajoss,direccion_trabajoss:this.direccion_trabajoss,telefono_trabajoss:this.telefono_trabajoss,cargoss:this.cargoss}).then(function(){b.$refs.stepper.next(),b.listaFamiliares(),b.$q.notify({type:"positive",message:"Actualizar con exito"})})["catch"](function(a){b.$q.notify({type:"negative",message:a.message||"Hubo un error al actualizar"})})["finally"](function(){b.$q.loading.hide()})):this.$q.notify({type:"negative",message:"la cedula es incorrecta"})}else this.$q.notify({type:"negative",message:"Esta cedula no pertenece a ninguna region"})}else this.$q.notify({type:"negative",message:"Esta cedula tiene menos de 10 Digitos"})}else this.$q.loading.show(),_.rput("familiares/".concat(this.ids),null,{ids:a.id,nombress:this.nombress,apellidoss:this.apellidoss,numero_documentoss:this.numero_documentoss,correoss:this.correoss,direccionss:this.direccionss,telefonoss:this.telefonoss,celularss:this.celularss,id_ctlg_profesioness:this.id_ctlg_profesioness,id_ctlg_estados_civilss:this.id_ctlg_estados_civilss,id_ctlg_cantoness:this.id_ctlg_cantoness,id_ctlg_parentescoss:this.id_ctlg_parentescoss,lugar_trabajoss:this.lugar_trabajoss,direccion_trabajoss:this.direccion_trabajoss,telefono_trabajoss:this.telefono_trabajoss,cargoss:this.cargoss}).then(function(){b.formActualizar=!1,b.listaFamiliares(),b.$q.notify({type:"positive",message:"Actualizado con exito"})})["catch"](function(a){b.$q.notify({type:"negative",message:a.message||"Hubo un error al actualizar"})})["finally"](function(){b.$q.loading.hide()})},eliminar:function eliminar(a){var b=this;this.ids=a.id_fami,this.$q.loading.show(),_.rdelete("familiares/elim/".concat(this.ids),null,{ids:a.id_fami}).then(function(){b.listaFamiliares(),b.$q.notify({type:"positive",message:"Eliminado con exito"})})["catch"](function(a){b.$q.notify({type:"negative",message:a.message||"Hubo un error al eliminar"})})["finally"](function(){b.$q.loading.hide()})},nuevoFamiliar:function nuevoFamiliar(){this.modal("rr",{})},listaFamiliares:function listaFamiliares(){var a=this;this.familiares.loading=!0,_.rget("familiares").then(function(b){a.familiares.data=b.data})["finally"](function(){a.familiares.loading=!1})}}};</script> <style></style> <template> <q-page class="q-pa-md"> <br /> <q-table class="q-pa-md" title="Representante" :data="familiares.data" :columns="familiares.columns" row-key="id" :filter="filter" :loading="familiares.loading" > <template v-slot:top-right> <div class="q-gutter-md row"> <q-btn color="primary" icon-right="add" label="Nuevo Representante" no-caps @click="nuevoFamiliar" ></q-btn> <q-btn color="teal" icon="save_alt" @click="excel"> <q-tooltip> Exportar a Excel </q-tooltip> </q-btn> <q-input filled borderless dense debounce="300" v-model="filter" placeholder="Search" > <template v-slot:append> <q-icon name="search" /> </template> </q-input> </div> </template> <template v-slot:header="props"> <q-tr text-align: center bgcolor="orange" :props="props"> <q-th auto-width style="text-align: center" v-for="col in props.cols" :key="col.name" :props="props" > {{ col.label }} </q-th> <q-th auto-width>Acción</q-th> </q-tr> </template> <template v-slot:body="props"> <q-tr :props="props"> <q-td style="text-align: center" v-for="col in props.cols" :key="col.name" :props="props" > {{ col.value | upper }} </q-td> <q-td auto-width style="text-align: center"> <template> <div class="q-gutter-sm"> <q-btn color="primary" round dense icon="edit" @click="editarFamiliar(props.row)" ></q-btn> <q-dialog v-model="formActualizar" persistent transition-show="scale" transition-hide="scale" > <q-card style="width: 300px"> <q-card-section> <div class="text-h6"> Representante </div> </q-card-section> <q-card-section style="max-height: 50vh" class="scroll" > <q-form class="q-gutter-md"> <q-input v-model="nombress" label="Nombres" lazy-rules :rules="[ (val) => (val && val.length > 0) || 'Please type something', ]" ></q-input> <q-input v-model="apellidoss" label="Apellidos" lazy-rules :rules="[ (val) => (val && val.length > 0) || 'Please type something', ]" ></q-input> <q-select disable v-model=" id_ctlg_tipos_documentoss " :options=" options.tipos_documentos " label="Tipo de documento" emit-value map-options ></q-select> <q-input v-model="numero_documentoss" label="Número de documento" type="number" lazy-rules :rules="[ (val) => (val && val.length > 0) || 'Please type something', ]" ></q-input> <q-select v-model=" id_ctlg_profesioness " :options=" options.profesiones " label="Profesión" emit-value map-options ></q-select> <q-select v-model=" id_ctlg_parentescoss " :options=" options.parentescos " label="Parentesco" emit-value map-options ></q-select> <q-input v-model="correoss" label="Correo" type="email" ></q-input> <q-input v-model="direccionss" label="Dirección" lazy-rules :rules="[ (val) => (val && val.length > 0) || 'Please type something', ]" ></q-input> <q-input v-model="telefonoss" label="Telefono" mask=" ### - ####" lazy-rules :rules="[ (val) => (val && val.length > 0) || 'Please type something', ]" ></q-input> <q-input v-model="celularss" label="Celular" type="tel" mask=" ##-########" lazy-rules :rules="[ (val) => (val && val.length > 0) || 'Please type something', ]" ></q-input> <q-select v-model=" id_ctlg_estados_civilss " :options=" options.estados_civil " label="Estados Civil" emit-value map-options ></q-select> <q-input v-model="lugar_trabajoss" label="Empresa que labora" ></q-input> <q-input v-model=" direccion_trabajoss " label="Direccion Trabajo" ></q-input> <q-select v-model="id_ctlg_cantoness" :options="options.cantones" label="Cantón de Trabajo" emit-value map-options ></q-select> <q-input v-model="telefono_trabajoss" label="Telefono Trabajo" mask=" ### - ####" ></q-input> <q-input v-model="cargoss" label="Cargo que ocupa" ></q-input> </q-form> </q-card-section> <q-card-actions align="right"> <q-btn @click="guardar" color="primary" >Guardar</q-btn > <q-btn flat v-close-popup >cancelar</q-btn > </q-card-actions> </q-card> </q-dialog> <q-btn color="negative" round dense icon="delete" @click="eliminar(props.row)" ></q-btn> <!--<q-dialog v-model="confirm" persistent> <q-card> <q-card-section class="row items-center"> <span class="q-ml-sm">Seguro que deseas eliminarlo.</span> </q-card-section> <q-card-actions align="right"> <q-btn @click="eliminar " color="primary"  >Eliminar</q-btn> <q-btn flat v-close-popup >Cancelar</q-btn> </q-card-actions> </q-card> </q-dialog>--> </div> </template> </q-td> </q-tr> </template> <template v-slot:loading> <q-inner-loading showing color="primary"></q-inner-loading> </template> </q-table> </q-page></template>